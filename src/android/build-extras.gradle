
def packageName = getPackageName()
def cleanPackagename = getCleanPackagename()

repositories {
    maven {
        url  "https://cardinalcommerce.bintray.com/android"
        credentials {
            username 'braintree-team-sdk@cardinalcommerce'
            password '220cc9476025679c4e5c843666c27d97cfb0f951'
        }
    }
}


android {
    defaultConfig {
        applicationId packageName
        manifestPlaceholders += [cleanPackagename:cleanPackagename]
    }
}

dependencies {
    implementation 'com.braintreepayments.api:drop-in:4.+'
    components.all {
      allVariants {
        withDependencies { deps ->
          deps.each { dep ->
            if (dep.group == 'net.minidev' && dep.name =='json-smart') {
              dep.version {
                  prefer "2.3"
              }
              dep.because "resolving dependencies issue"
            }
          }
        }
      }
    }
}

def getPackageName() {
    def config;
    if (file("src/main/res/xml/config.xml").exists()) {
        // cordova-android >= 7.0.0
        config = file("src/main/res/xml/config.xml").getText()
    } else {
        // cordova-android < 7.0.0
        config = file("res/xml/config.xml").getText()
    }

    def xml = new XmlParser(false, false).parseText(config)
    return xml.attribute("id")
}

def getCleanPackagename() {
    def packageName = getPackageName();
    return packageName.replace('_', '').toLowerCase();
}
